<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Button Quest</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
        }

        .phase {
            position: absolute;
            width: 100%;
            height: 100%;
            display: none;
            opacity: 0;
            transition: opacity 0.8s ease-in-out;
        }

        .phase.active {
            display: flex;
            opacity: 1;
        }

        /* Phase 0: Welcome Screen */
        #phase0 {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .welcome-message {
            color: white;
            font-size: 3em;
            text-align: center;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.4);
            margin-bottom: 30px;
            animation: fadeIn 1s ease-in;
        }

        .welcome-subtitle {
            color: rgba(255,255,255,0.9);
            font-size: 1.3em;
            text-align: center;
            margin-bottom: 50px;
            animation: fadeIn 1.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .start-button {
            padding: 25px 60px;
            font-size: 28px;
            font-weight: bold;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            box-shadow: 0 10px 30px rgba(0,0,0,0.4);
            animation: fadeIn 2s ease-in, pulse 2s infinite;
            transition: transform 0.2s;
        }

        .start-button:hover {
            transform: scale(1.1);
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 10px 30px rgba(0,0,0,0.4); }
            50% { box-shadow: 0 10px 40px rgba(245,87,108,0.6); }
        }

        /* Phase 1: Torch/Flashlight Game */
        #phase1 {
            background: linear-gradient(135deg, #8B7355 0%, #6B5344 100%);
            align-items: center;
            justify-content: center;
        }

        .phase-title {
            position: absolute;
            top: 30px;
            color: white;
            font-size: 1.8em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            z-index: 100;
        }

        .room-object {
            position: absolute;
            font-size: 60px;
            user-select: none;
            pointer-events: none;
            z-index: 5;
        }

        .torch-button {
            padding: 15px 35px;
            font-size: 20px;
            font-weight: bold;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            position: absolute;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            user-select: none;
            z-index: 10;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        .torch-button.real {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            animation: subtleGlow 3s ease-in-out infinite;
        }

        @keyframes subtleGlow {
            0%, 100% { box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
            50% { box-shadow: 0 4px 25px rgba(240, 147, 251, 0.5); }
        }

        #torchCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 50;
        }

        /* Phase 2: Repulse/Attract Game */
        #phase2 {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            align-items: center;
            justify-content: center;
        }

        .phase2-button {
            padding: 20px 40px;
            font-size: 24px;
            font-weight: bold;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            position: absolute;
            transition: transform 0.1s ease-out;
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
            user-select: none;
        }

        #noButton {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        #yesButton {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        /* Phase 3: Giant Button */
        #phase3 {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            align-items: center;
            justify-content: center;
        }

        #giantButton {
            position: absolute;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            font-size: 48px;
            font-weight: bold;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 1;
        }

        #giantButton:hover {
            transform: scale(1.02);
        }

        #tinyButton {
            position: absolute;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            font-size: 12px;
            padding: 8px 16px;
            font-weight: bold;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 2;
            user-select: none;
        }

        .emoji {
            margin-left: 10px;
        }

        @media (max-width: 768px) {
            .welcome-message {
                font-size: 2em;
                padding: 0 20px;
            }

            .welcome-subtitle {
                font-size: 1em;
                padding: 0 20px;
            }

            .start-button {
                padding: 20px 40px;
                font-size: 22px;
            }

            .phase-title {
                font-size: 1.3em;
                padding: 0 20px;
            }

            #giantButton {
                font-size: 32px;
            }
        }
    </style>
</head>
<body>
    <!-- Phase 0: Welcome Screen -->
    <div id="phase0" class="phase active">
        <h1 class="welcome-message">Welcome to The Button Quest! üéÆ</h1>
        <p class="welcome-subtitle">Can you complete all three challenges?</p>
        <button class="start-button" onclick="startGame()">Start Adventure ‚ú®</button>
    </div>

    <!-- Phase 1: Torch Game -->
    <div id="phase1" class="phase">
        <h2 class="phase-title">Find the Hidden Button üî¶</h2>
        <canvas id="torchCanvas"></canvas>
    </div>

    <!-- Phase 2: Repulse/Attract Game -->
    <div id="phase2" class="phase">
        <h2 class="phase-title">Catch the "Yes" Button! üòç</h2>
        <button id="noButton" class="phase2-button">No <span class="emoji">üò±</span></button>
        <button id="yesButton" class="phase2-button">Yes <span class="emoji">üòç</span></button>
    </div>

    <!-- Phase 3: Giant Button -->
    <div id="phase3" class="phase">
        <h2 class="phase-title">The Final Challenge: Click "Escape"! üèÉ</h2>
        <button id="giantButton">CLICK ME! <span class="emoji">üòà</span></button>
        <button id="tinyButton">Escape <span class="emoji">üèÉ</span></button>
    </div>

    <script>
        let currentPhase = 0;
        let mouseX = window.innerWidth / 2;
        let mouseY = window.innerHeight / 2;
        let animationFrame = null;

        // Track mouse position
        document.addEventListener('mousemove', (e) => {
            mouseX = e.clientX;
            mouseY = e.clientY;
        });

        // Utility function
        function getDistance(x1, y1, x2, y2) {
            return Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));
        }

        function transitionToPhase(phase) {
            const current = document.getElementById(`phase${currentPhase}`);
            const next = document.getElementById(`phase${phase}`);
            
            current.style.opacity = '0';
            setTimeout(() => {
                current.classList.remove('active');
                next.classList.add('active');
                setTimeout(() => {
                    next.style.opacity = '1';
                }, 50);
            }, 800);
            
            currentPhase = phase;
            
            // Initialize phase-specific logic
            if (phase === 1) initPhase1();
            if (phase === 2) initPhase2();
            if (phase === 3) initPhase3();
        }

        function startGame() {
            transitionToPhase(1);
        }

        // ===== PHASE 1: TORCH GAME =====
        let phase1Buttons = [];
        let hiddenButtonIndex = -1;

        function initPhase1() {
            phase1Buttons = [];
            const phase1 = document.getElementById('phase1');
            
            // Clear any existing content
            const oldButtons = phase1.querySelectorAll('.torch-button');
            oldButtons.forEach(btn => btn.remove());
            const oldObjects = phase1.querySelectorAll('.room-object');
            oldObjects.forEach(obj => obj.remove());
            
            // Add room objects (furniture, plants, etc.)
            const roomObjects = [
                { emoji: 'ü™¥', left: '10%', top: '25%' },
                { emoji: 'ü™¥', left: '85%', top: '30%' },
                { emoji: 'üñºÔ∏è', left: '20%', top: '15%' },
                { emoji: 'üñºÔ∏è', left: '70%', top: '20%' },
                { emoji: 'ü™ë', left: '15%', top: '60%' },
                { emoji: 'üõãÔ∏è', left: '75%', top: '65%' },
                { emoji: 'üìö', left: '8%', top: '75%' },
                { emoji: 'üïØÔ∏è', left: '50%', top: '20%' },
                { emoji: 'üé®', left: '40%', top: '15%' },
                { emoji: 'üß∏', left: '88%', top: '70%' },
                { emoji: 'üì∫', left: '45%', top: '75%' },
                { emoji: 'üåµ', left: '92%', top: '45%' }
            ];
            
            roomObjects.forEach(obj => {
                const div = document.createElement('div');
                div.className = 'room-object';
                div.textContent = obj.emoji;
                div.style.left = obj.left;
                div.style.top = obj.top;
                phase1.appendChild(div);
            });
            
            // Create buttons (1 real, 9 decoys)
            const numButtons = 10;
            hiddenButtonIndex = Math.floor(Math.random() * numButtons);
            
            for (let i = 0; i < numButtons; i++) {
                const btn = document.createElement('button');
                btn.className = 'torch-button';
                
                const isReal = i === hiddenButtonIndex;
                if (isReal) {
                    btn.classList.add('real');
                    btn.textContent = 'NEXT! ‚ú®';
                } else {
                    btn.textContent = 'Decoy üé≠';
                }
                
                // Random position, avoiding edges
                btn.style.left = Math.random() * 70 + 15 + '%';
                btn.style.top = Math.random() * 60 + 20 + '%';
                
                btn.addEventListener('click', () => {
                    if (isReal) {
                        transitionToPhase(2);
                    } else {
                        btn.style.background = 'linear-gradient(135deg, #ff6b6b 0%, #c92a2a 100%)';
                        btn.textContent = 'Wrong! ‚ùå';
                        setTimeout(() => {
                            btn.style.background = 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)';
                            btn.textContent = 'Decoy üé≠';
                        }, 500);
                    }
                });
                
                phase1.appendChild(btn);
                phase1Buttons.push(btn);
            }
            
            setupTorchEffect();
        }

        function setupTorchEffect() {
            const canvas = document.getElementById('torchCanvas');
            const ctx = canvas.getContext('2d');
            
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            function drawTorch() {
                if (currentPhase !== 1) return;
                
                // Clear canvas
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Fill entire canvas with very dark overlay (almost black)
                ctx.fillStyle = 'rgba(0, 0, 0, 0.95)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Cut out the torch light area to reveal what's underneath
                const torchRadius = 180;
                
                // Create the flashlight effect - we'll draw a gradient that fades from
                // transparent (revealing room) to black (dark overlay)
                const gradient = ctx.createRadialGradient(
                    mouseX, mouseY, 0,
                    mouseX, mouseY, torchRadius
                );
                
                // Center is transparent (reveals room), edges fade to black
                gradient.addColorStop(0, 'rgba(0, 0, 0, 0)');           // Fully transparent center
                gradient.addColorStop(0.6, 'rgba(0, 0, 0, 0)');         // Keep center clear
                gradient.addColorStop(0.85, 'rgba(0, 0, 0, 0.5)');      // Start fading
                gradient.addColorStop(1, 'rgba(0, 0, 0, 0.95)');        // Match outer darkness
                
                // Use destination-out to "erase" the dark overlay where the torch is
                ctx.globalCompositeOperation = 'destination-out';
                ctx.fillStyle = gradient;
                ctx.beginPath();
                ctx.arc(mouseX, mouseY, torchRadius, 0, Math.PI * 2);
                ctx.fill();
                
                // Add a subtle yellow glow effect on top
                ctx.globalCompositeOperation = 'source-over';
                const glowGradient = ctx.createRadialGradient(
                    mouseX, mouseY, 0,
                    mouseX, mouseY, torchRadius * 0.7
                );
                glowGradient.addColorStop(0, 'rgba(255, 240, 150, 0.15)');
                glowGradient.addColorStop(0.5, 'rgba(255, 220, 100, 0.08)');
                glowGradient.addColorStop(1, 'rgba(255, 200, 50, 0)');
                
                ctx.fillStyle = glowGradient;
                ctx.beginPath();
                ctx.arc(mouseX, mouseY, torchRadius * 0.7, 0, Math.PI * 2);
                ctx.fill();
                
                requestAnimationFrame(drawTorch);
            }
            
            drawTorch();
        }

        // ===== PHASE 2: REPULSE/ATTRACT GAME =====
        let phase2Active = false;

        function initPhase2() {
            phase2Active = true;
            const noButton = document.getElementById('noButton');
            const yesButton = document.getElementById('yesButton');
            
            // Reset positions
            noButton.style.left = '40%';
            noButton.style.top = '50%';
            noButton.style.transform = 'translate(-50%, -50%)';
            
            yesButton.style.left = '60%';
            yesButton.style.top = '50%';
            yesButton.style.transform = 'translate(-50%, -50%)';
            
            yesButton.onclick = () => {
                phase2Active = false;
                transitionToPhase(3);
            };
            
            noButton.onclick = () => {
                alert('Nice try! But you need to click "Yes"! üòÖ');
            };
            
            animatePhase2();
        }

        function animatePhase2() {
            if (!phase2Active || currentPhase !== 2) return;
            
            const noButton = document.getElementById('noButton');
            const yesButton = document.getElementById('yesButton');
            
            // Repel "No" button
            const noRect = noButton.getBoundingClientRect();
            const noCenterX = noRect.left + noRect.width / 2;
            const noCenterY = noRect.top + noRect.height / 2;
            const noDistance = getDistance(mouseX, mouseY, noCenterX, noCenterY);
            
            if (noDistance < 150) {
                const angle = Math.atan2(noCenterY - mouseY, noCenterX - mouseX);
                const force = (150 - noDistance) / 150;
                const moveDistance = force * 30;
                
                let newX = noCenterX + Math.cos(angle) * moveDistance;
                let newY = noCenterY + Math.sin(angle) * moveDistance;
                
                newX = Math.max(50, Math.min(window.innerWidth - 50, newX));
                newY = Math.max(50, Math.min(window.innerHeight - 50, newY));
                
                noButton.style.left = newX + 'px';
                noButton.style.top = newY + 'px';
                noButton.style.transform = 'translate(-50%, -50%)';
            }
            
            // Attract "Yes" button
            const yesRect = yesButton.getBoundingClientRect();
            const yesCenterX = yesRect.left + yesRect.width / 2;
            const yesCenterY = yesRect.top + yesRect.height / 2;
            const yesDistance = getDistance(mouseX, mouseY, yesCenterX, yesCenterY);
            
            if (yesDistance < 200 && yesDistance > 10) {
                const angle = Math.atan2(mouseY - yesCenterY, mouseX - yesCenterX);
                const force = (200 - yesDistance) / 200;
                const moveDistance = force * 15;
                
                let newX = yesCenterX + Math.cos(angle) * moveDistance;
                let newY = yesCenterY + Math.sin(angle) * moveDistance;
                
                newX = Math.max(50, Math.min(window.innerWidth - 50, newX));
                newY = Math.max(50, Math.min(window.innerHeight - 50, newY));
                
                yesButton.style.left = newX + 'px';
                yesButton.style.top = newY + 'px';
                yesButton.style.transform = 'translate(-50%, -50%)';
            }
            
            requestAnimationFrame(animatePhase2);
        }

        // ===== PHASE 3: GIANT BUTTON =====
        let phase3Active = false;

        function initPhase3() {
            phase3Active = true;
            const giantButton = document.getElementById('giantButton');
            const tinyButton = document.getElementById('tinyButton');
            
            // Set giant button to take up most of the screen
            const margin = 60;
            giantButton.style.width = (window.innerWidth - margin * 2) + 'px';
            giantButton.style.height = (window.innerHeight - margin * 2) + 'px';
            giantButton.style.left = margin + 'px';
            giantButton.style.top = margin + 'px';
            
            // Position tiny button at edge
            tinyButton.style.left = '20px';
            tinyButton.style.top = '20px';
            
            giantButton.onclick = () => {
                phase3Active = false;
                showVictory();
            };
            
            tinyButton.onclick = () => {
                alert('So close! But this button is impossible to click! üòà');
            };
            
            animatePhase3();
        }

        function animatePhase3() {
            if (!phase3Active || currentPhase !== 3) return;
            
            const tinyButton = document.getElementById('tinyButton');
            const rect = tinyButton.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            const distance = getDistance(mouseX, mouseY, centerX, centerY);
            
            if (distance < 200) {
                const angle = Math.atan2(centerY - mouseY, centerX - mouseX);
                const force = (200 - distance) / 200;
                const moveDistance = force * 40;
                
                let newX = centerX + Math.cos(angle) * moveDistance;
                let newY = centerY + Math.sin(angle) * moveDistance;
                
                // Keep button near edges only
                const edgeMargin = 30;
                newX = Math.max(edgeMargin, Math.min(window.innerWidth - edgeMargin, newX));
                newY = Math.max(edgeMargin, Math.min(window.innerHeight - edgeMargin, newY));
                
                tinyButton.style.left = newX + 'px';
                tinyButton.style.top = newY + 'px';
                tinyButton.style.transform = 'translate(-50%, -50%)';
            }
            
            requestAnimationFrame(animatePhase3);
        }

        function showVictory() {
            const phase3 = document.getElementById('phase3');
            phase3.innerHTML = `
                <div style="display: flex; flex-direction: column; align-items: center; justify-content: center;">
                    <h1 style="color: white; font-size: 4em; text-shadow: 3px 3px 6px rgba(0,0,0,0.4); animation: fadeIn 1s ease-in;">
                        üéâ VICTORY! üéâ
                    </h1>
                    <p style="color: white; font-size: 1.5em; margin-top: 20px; animation: fadeIn 1.5s ease-in;">
                        You completed all three challenges!
                    </p>
                    <button onclick="location.reload()" style="
                        margin-top: 40px;
                        padding: 20px 40px;
                        font-size: 24px;
                        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
                        color: white;
                        border: none;
                        border-radius: 50px;
                        cursor: pointer;
                        box-shadow: 0 10px 30px rgba(0,0,0,0.4);
                        animation: fadeIn 2s ease-in;
                    ">Play Again ‚Üª</button>
                </div>
            `;
        }

        // Handle window resize
        window.addEventListener('resize', () => {
            if (currentPhase === 1) {
                const canvas = document.getElementById('torchCanvas');
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            } else if (currentPhase === 3 && phase3Active) {
                const giantButton = document.getElementById('giantButton');
                const margin = 60;
                giantButton.style.width = (window.innerWidth - margin * 2) + 'px';
                giantButton.style.height = (window.innerHeight - margin * 2) + 'px';
            }
        });
    </script>
</body>
</html>
